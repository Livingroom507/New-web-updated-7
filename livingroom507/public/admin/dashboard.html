<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empath Closer Admin Dashboard | Oversight & Collaboration</title>
    <style>
        /* Placeholder CSS for readability and structure */
        body { font-family: sans-serif; padding: 20px; background-color: #f4f7f9; }
        .dashboard-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .stat-box { background: white; padding: 15px 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); text-align: center; }
        .stat-box h3 { margin-top: 0; color: #0056b3; font-size: 1.2em; }
        .profile-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .profile-table th, .profile-table td { border: 1px solid #ddd; padding: 10px; text-align: left; font-size: 0.9em; }
        
        /* Collaboration Panel Styles */
        .collab-control-panel { background: #fff; padding: 20px; border-radius: 8px; margin-top: 30px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        #product-control-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 20px; }
        .control-group { border: 1px solid #e0e0e0; padding: 10px; border-radius: 4px; }
        .control-group label { font-weight: bold; display: block; margin-bottom: 5px; color: #333; }
        .control-group button { background-color: #4CAF50; color: white; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; transition: background-color 0.3s; }
        .control-group button:hover { background-color: #45a049; }
        .control-group span { margin-left: 10px; font-style: italic; color: #777; }
    </style>
</head>
<body>

    <div class="dashboard-header">
        <h1>Empath Closer Admin Dashboard üìä</h1>
        <div id="team-summary" style="display: flex; gap: 20px;">
            <div class="stat-box"><h3>Total Closers: <span id="total-closers">--</span></h3></div>
            <div class="stat-box"><h3>Module 3 Mastery: <span id="mastery-count">--</span></h3></div>
        </div>
    </div>

    <h2>Team Communication üìß</h2>
    <button onclick="openEmailModal()">Send Team Update/Offer</button>

    ---

    <h2>Certified Closer Profiles & Performance</h2>
    <table class="profile-table" id="closer-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>M3 Score</th>
                <th>Niche Interest</th>
                <th>Placement Date</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            </tbody>
    </table>

    ---

    <div class="collab-control-panel">
        <h2>Live Collaboration: Dropshipping Niche ü§ù</h2>
        <p>Use this panel to instantly highlight the selected product category on the client's screen (Session ID: <span id="collab-session-id">---</span>).</p>
        
        <div id="product-control-grid">
            
            <div class="control-group">
                <label>1. Women's Dresses</label>
                <button onclick="sendAdminSelection('dresses', 'Women\'s Dresses')">Confirm Selection</button>
                <span id="admin-status-dresses">Ready</span>
            </div>

            <div class="control-group">
                <label>2. T-Shirts</label>
                <button onclick="sendAdminSelection('t-shirts', 'T-Shirts')">Confirm Selection</button>
                <span id="admin-status-t-shirts">Ready</span>
            </div>

            <div class="control-group">
                <label>3. Activewear</label>
                <button onclick="sendAdminSelection('activewear', 'Activewear')">Confirm Selection</button>
                <span id="admin-status-activewear">Ready</span>
            </div>

            <div class="control-group">
                <label>4. Jewelry</label>
                <button onclick="sendAdminSelection('jewelry', 'Jewelry')">Confirm Selection</button>
                <span id="admin-status-jewelry">Ready</span>
            </div>

            <div class="control-group">
                <label>5. Streetwear</label>
                <button onclick="sendAdminSelection('streetwear', 'Streetwear')">Confirm Selection</button>
                <span id="admin-status-streetwear">Ready</span>
            </div>

            <div class="control-group">
                <label>6. Handbags/Accessories</label>
                <button onclick="sendAdminSelection('handbags', 'Handbags')">Confirm Selection</button>
                <span id="admin-status-handbags">Ready</span>
            </div>
        </div>
    </div>
    
    <script>
        // NOTE: These placeholder variables must be securely obtained via a login process.
        const AUTH_TOKEN = 'YOUR_SECURE_ADMIN_KEY'; 
        const API_ENDPOINT = '/api/admin/data'; 
        const PUSH_ENDPOINT = '/api/push-collab-update';
        
        // This should be dynamically set when the admin selects a client profile
        let CURRENT_CLIENT_SESSION_ID = 'SESSION_XYZ_123'; 
        
        // --------------------------------------------------------
        // 1. DASHBOARD DATA FETCHING (From a previous response)
        // --------------------------------------------------------
        async function fetchAdminData() {
            try {
                const response = await fetch(API_ENDPOINT, {
                    headers: { 'X-Admin-Auth': AUTH_TOKEN }
                });
                // ... rest of the fetch logic and rendering ...
            } catch (error) {
                console.error("Could not load admin data:", error);
            }
        }
        
        // --------------------------------------------------------
        // 2. LIVE COLLABORATION PUSH LOGIC (From the last response)
        // --------------------------------------------------------
        async function sendAdminSelection(categoryId, categoryName) {
            const statusElement = document.getElementById(`admin-status-${categoryId}`);
            statusElement.textContent = 'Sending...';

            const clientUpdateMessage = `‚úÖ Focus confirmed: ${categoryName}`;

            try {
                const response = await fetch(`${PUSH_ENDPOINT}?sessionId=${CURRENT_CLIENT_SESSION_ID}`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'X-Admin-Auth': AUTH_TOKEN 
                    },
                    body: JSON.stringify({
                        action: 'confirm_selection',
                        category: categoryId,
                        categoryName: categoryName,
                        message: clientUpdateMessage,
                        color: 'green'
                    })
                });

                if (response.status === 401) {
                    statusElement.textContent = 'Auth Error';
                    alert('Admin Authentication Failed.');
                    return;
                }

                if (response.ok) {
                    statusElement.textContent = 'Confirmed!';
                    statusElement.style.color = '#28a745'; 
                    // Log to the D1 table for long-term tracking
                    logClientFinalSelection(CURRENT_CLIENT_SESSION_ID, categoryId, categoryName);
                } else {
                    statusElement.textContent = 'Push Failed';
                    statusElement.style.color = '#dc3545';
                    console.error('DO Push Failure:', await response.text());
                }
            } catch (e) {
                statusElement.textContent = 'Network Error!';
                statusElement.style.color = '#dc3545';
                console.error('Push failed:', e);
            }
        }

        // Placeholder function (needs a secure API call to D1)
        function logClientFinalSelection(sessionId, categoryId, categoryName) {
            console.log(`[D1 Log] Logging final selection for session ${sessionId}: ${categoryName}`);
        }

        // Placeholder for the communication modal
        function openEmailModal() {
            alert('Email Modal functionality triggered.');
        }

        // Initialize dashboard on load
        fetchAdminData();
        document.getElementById('collab-session-id').textContent = CURRENT_CLIENT_SESSION_ID;

    </script>
</body>
</html>